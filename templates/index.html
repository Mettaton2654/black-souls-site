{% extends "base.html" %}

{% block content %}
<h1 class="page-title">Последние посты</h1>

<div class="posts">
    {% for post in posts %}
        <div class="post-card">
            <div class="post-header">
                <img src="{{ url_for('static', filename='uploads/' + post.author.avatar) }}" alt="avatar" class="avatar" onerror="this.src='https://via.placeholder.com/50/1a1a1a/b30000?text=?'">
                <span class="username">{{ post.author.username }}</span>
                <span class="post-date">{{ post.date_posted.strftime('%d.%m.%Y %H:%M') }}</span>
                {% if current_user.is_authenticated and (current_user.is_admin or current_user.id == post.user_id) %}
                    <div class="post-actions">
                        <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn btn-sm">Редактировать</a>
                        <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" style="display:inline;" onsubmit="return confirm('Удалить пост?');">
                            <button type="submit" class="btn btn-sm btn-danger">Удалить</button>
                        </form>
                    </div>
                {% endif %}
            </div>
            <div class="post-content">
                {{ post.content }}
            </div>
            {% if post.attachments %}
                <div class="post-attachments">
                    <strong>Вложения:</strong>
                    <ul>
                    {% for att in post.attachments %}
                        <li><a href="{{ url_for('static', filename='uploads/' + att.file_url) }}" target="_blank">{{ att.filename }}</a></li>
                    {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
    {% else %}
        <p>Пока нет постов.</p>
    {% endfor %}
</div>
{% endblock %}